                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 3.9.0 #11195 (FreeBSD)
                                      4 ;--------------------------------------------------------
                                      5 	.module stm8s_flash_private
                                      6 	.optsdcc -mstm8
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _FLASH_WaitForLastOperation
                                     12 	.globl _FLASH_EraseBlock
                                     13 	.globl _FLASH_ProgramBlock
                                     14 ;--------------------------------------------------------
                                     15 ; ram data
                                     16 ;--------------------------------------------------------
                                     17 	.area DATA
                                     18 ;--------------------------------------------------------
                                     19 ; ram data
                                     20 ;--------------------------------------------------------
                                     21 	.area INITIALIZED
                                     22 ;--------------------------------------------------------
                                     23 ; absolute external ram data
                                     24 ;--------------------------------------------------------
                                     25 	.area DABS (ABS)
                                     26 
                                     27 ; default segment ordering for linker
                                     28 	.area HOME
                                     29 	.area GSINIT
                                     30 	.area GSFINAL
                                     31 	.area CONST
                                     32 	.area INITIALIZER
                                     33 	.area CODE
                                     34 
                                     35 ;--------------------------------------------------------
                                     36 ; global & static initialisations
                                     37 ;--------------------------------------------------------
                                     38 	.area HOME
                                     39 	.area GSINIT
                                     40 	.area GSFINAL
                                     41 	.area GSINIT
                                     42 ;--------------------------------------------------------
                                     43 ; Home
                                     44 ;--------------------------------------------------------
                                     45 	.area HOME
                                     46 	.area HOME
                                     47 ;--------------------------------------------------------
                                     48 ; code
                                     49 ;--------------------------------------------------------
                                     50 	.area CODE
                                     51 ;	./src/stm8s_flash_private.c: 120: IN_RAM(FLASH_Status_TypeDef FLASH_WaitForLastOperation(FLASH_MemType_TypeDef FLASH_MemType)) 
                                     52 ;	-----------------------------------------
                                     53 ;	 function FLASH_WaitForLastOperation
                                     54 ;	-----------------------------------------
      000000                         55 _FLASH_WaitForLastOperation:
                                     56 ;	./src/stm8s_flash_private.c: 122: uint8_t flagstatus = 0x00;
      000000 4F               [ 1]   57 	clr	a
                                     58 ;	./src/stm8s_flash_private.c: 147: while((flagstatus == 0x00) && (timeout != 0x00))
      000001 5F               [ 1]   59 	clrw	x
      000002 5A               [ 2]   60 	decw	x
      000003                         61 00102$:
      000003 4D               [ 1]   62 	tnz	a
      000004 26 0B            [ 1]   63 	jrne	00104$
      000006 5D               [ 2]   64 	tnzw	x
      000007 27 08            [ 1]   65 	jreq	00104$
                                     66 ;	./src/stm8s_flash_private.c: 149: flagstatus = (uint8_t)(FLASH->IAPSR & (FLASH_IAPSR_EOP | FLASH_IAPSR_WR_PG_DIS));
      000009 C6 50 5F         [ 1]   67 	ld	a, 0x505f
      00000C A4 05            [ 1]   68 	and	a, #0x05
                                     69 ;	./src/stm8s_flash_private.c: 150: timeout--;
      00000E 5A               [ 2]   70 	decw	x
      00000F 20 F2            [ 2]   71 	jra	00102$
      000011                         72 00104$:
                                     73 ;	./src/stm8s_flash_private.c: 154: if(timeout == 0x00 )
      000011 5D               [ 2]   74 	tnzw	x
      000012 27 01            [ 1]   75 	jreq	00132$
      000014 81               [ 4]   76 	ret
      000015                         77 00132$:
                                     78 ;	./src/stm8s_flash_private.c: 156: flagstatus = FLASH_STATUS_TIMEOUT;
      000015 A6 02            [ 1]   79 	ld	a, #0x02
                                     80 ;	./src/stm8s_flash_private.c: 159: return((FLASH_Status_TypeDef)flagstatus);
                                     81 ;	./src/stm8s_flash_private.c: 160: }
      000017 81               [ 4]   82 	ret
                                     83 ;	./src/stm8s_flash_private.c: 169: IN_RAM(void FLASH_EraseBlock(uint16_t BlockNum, FLASH_MemType_TypeDef FLASH_MemType))
                                     84 ;	-----------------------------------------
                                     85 ;	 function FLASH_EraseBlock
                                     86 ;	-----------------------------------------
      000018                         87 _FLASH_EraseBlock:
      000018 52 06            [ 2]   88 	sub	sp, #6
                                     89 ;	./src/stm8s_flash_private.c: 182: if(FLASH_MemType == FLASH_MEMTYPE_PROG)
      00001A 7B 0B            [ 1]   90 	ld	a, (0x0b, sp)
      00001C A1 FD            [ 1]   91 	cp	a, #0xfd
      00001E 26 0A            [ 1]   92 	jrne	00102$
                                     93 ;	./src/stm8s_flash_private.c: 185: startaddress = FLASH_PROG_START_PHYSICAL_ADDRESS;
      000020 AE 80 00         [ 2]   94 	ldw	x, #0x8000
      000023 1F 03            [ 2]   95 	ldw	(0x03, sp), x
      000025 5F               [ 1]   96 	clrw	x
      000026 1F 01            [ 2]   97 	ldw	(0x01, sp), x
      000028 20 08            [ 2]   98 	jra	00103$
      00002A                         99 00102$:
                                    100 ;	./src/stm8s_flash_private.c: 190: startaddress = FLASH_DATA_START_PHYSICAL_ADDRESS;
      00002A AE 40 00         [ 2]  101 	ldw	x, #0x4000
      00002D 1F 03            [ 2]  102 	ldw	(0x03, sp), x
      00002F 5F               [ 1]  103 	clrw	x
      000030 1F 01            [ 2]  104 	ldw	(0x01, sp), x
      000032                        105 00103$:
                                    106 ;	./src/stm8s_flash_private.c: 198: pwFlash = (PointerAttr uint32_t *)(MemoryAddressCast)(startaddress + ((uint32_t)BlockNum * FLASH_BLOCK_SIZE));
      000032 1E 09            [ 2]  107 	ldw	x, (0x09, sp)
      000034 58               [ 2]  108 	sllw	x
      000035 58               [ 2]  109 	sllw	x
      000036 58               [ 2]  110 	sllw	x
      000037 58               [ 2]  111 	sllw	x
      000038 58               [ 2]  112 	sllw	x
      000039 58               [ 2]  113 	sllw	x
      00003A 1F 05            [ 2]  114 	ldw	(0x05, sp), x
      00003C 7B 04            [ 1]  115 	ld	a, (0x04, sp)
      00003E 02               [ 1]  116 	rlwa	x
      00003F 7B 03            [ 1]  117 	ld	a, (0x03, sp)
      000041 01               [ 1]  118 	rrwa	x
      000042 97               [ 1]  119 	ld	xl, a
      000043 72 FB 05         [ 2]  120 	addw	x, (0x05, sp)
                                    121 ;	./src/stm8s_flash_private.c: 202: FLASH->CR2 |= FLASH_CR2_ERASE;
      000046 72 1A 50 5B      [ 1]  122 	bset	20571, #5
                                    123 ;	./src/stm8s_flash_private.c: 203: FLASH->NCR2 &= (uint8_t)(~FLASH_NCR2_NERASE);
      00004A 72 1B 50 5C      [ 1]  124 	bres	20572, #5
                                    125 ;	./src/stm8s_flash_private.c: 207: *pwFlash = (uint32_t)0;
      00004E 90 5F            [ 1]  126 	clrw	y
      000050 EF 02            [ 2]  127 	ldw	(0x2, x), y
      000052 FF               [ 2]  128 	ldw	(x), y
                                    129 ;	./src/stm8s_flash_private.c: 215: }
      000053 5B 06            [ 2]  130 	addw	sp, #6
      000055 81               [ 4]  131 	ret
                                    132 ;	./src/stm8s_flash_private.c: 226: IN_RAM(void FLASH_ProgramBlock(uint16_t BlockNum, FLASH_MemType_TypeDef FLASH_MemType, 
                                    133 ;	-----------------------------------------
                                    134 ;	 function FLASH_ProgramBlock
                                    135 ;	-----------------------------------------
      000056                        136 _FLASH_ProgramBlock:
      000056 52 08            [ 2]  137 	sub	sp, #8
                                    138 ;	./src/stm8s_flash_private.c: 235: if(FLASH_MemType == FLASH_MEMTYPE_PROG)
      000058 7B 0D            [ 1]  139 	ld	a, (0x0d, sp)
      00005A A1 FD            [ 1]  140 	cp	a, #0xfd
      00005C 26 0A            [ 1]  141 	jrne	00102$
                                    142 ;	./src/stm8s_flash_private.c: 238: startaddress = FLASH_PROG_START_PHYSICAL_ADDRESS;
      00005E AE 80 00         [ 2]  143 	ldw	x, #0x8000
      000061 1F 03            [ 2]  144 	ldw	(0x03, sp), x
      000063 5F               [ 1]  145 	clrw	x
      000064 1F 01            [ 2]  146 	ldw	(0x01, sp), x
      000066 20 08            [ 2]  147 	jra	00103$
      000068                        148 00102$:
                                    149 ;	./src/stm8s_flash_private.c: 243: startaddress = FLASH_DATA_START_PHYSICAL_ADDRESS;
      000068 AE 40 00         [ 2]  150 	ldw	x, #0x4000
      00006B 1F 03            [ 2]  151 	ldw	(0x03, sp), x
      00006D 5F               [ 1]  152 	clrw	x
      00006E 1F 01            [ 2]  153 	ldw	(0x01, sp), x
      000070                        154 00103$:
                                    155 ;	./src/stm8s_flash_private.c: 247: startaddress = startaddress + ((uint32_t)BlockNum * FLASH_BLOCK_SIZE);
      000070 16 0B            [ 2]  156 	ldw	y, (0x0b, sp)
      000072 5F               [ 1]  157 	clrw	x
      000073 88               [ 1]  158 	push	a
      000074 A6 06            [ 1]  159 	ld	a, #0x06
      000076                        160 00131$:
      000076 90 58            [ 2]  161 	sllw	y
      000078 59               [ 2]  162 	rlcw	x
      000079 4A               [ 1]  163 	dec	a
      00007A 26 FA            [ 1]  164 	jrne	00131$
      00007C 17 08            [ 2]  165 	ldw	(0x08, sp), y
      00007E 84               [ 1]  166 	pop	a
      00007F 16 07            [ 2]  167 	ldw	y, (0x07, sp)
      000081 72 F9 03         [ 2]  168 	addw	y, (0x03, sp)
      000084 9F               [ 1]  169 	ld	a, xl
      000085 19 02            [ 1]  170 	adc	a, (0x02, sp)
      000087 02               [ 1]  171 	rlwa	x
      000088 19 01            [ 1]  172 	adc	a, (0x01, sp)
      00008A 95               [ 1]  173 	ld	xh, a
      00008B 17 03            [ 2]  174 	ldw	(0x03, sp), y
      00008D 1F 01            [ 2]  175 	ldw	(0x01, sp), x
                                    176 ;	./src/stm8s_flash_private.c: 253: FLASH->CR2 |= FLASH_CR2_PRG;
      00008F C6 50 5B         [ 1]  177 	ld	a, 0x505b
                                    178 ;	./src/stm8s_flash_private.c: 250: if(FLASH_ProgMode == FLASH_PROGRAMMODE_STANDARD)
      000092 0D 0E            [ 1]  179 	tnz	(0x0e, sp)
      000094 26 0B            [ 1]  180 	jrne	00105$
                                    181 ;	./src/stm8s_flash_private.c: 253: FLASH->CR2 |= FLASH_CR2_PRG;
      000096 AA 01            [ 1]  182 	or	a, #0x01
      000098 C7 50 5B         [ 1]  183 	ld	0x505b, a
                                    184 ;	./src/stm8s_flash_private.c: 254: FLASH->NCR2 &= (uint8_t)(~FLASH_NCR2_NPRG);
      00009B 72 11 50 5C      [ 1]  185 	bres	20572, #0
      00009F 20 09            [ 2]  186 	jra	00114$
      0000A1                        187 00105$:
                                    188 ;	./src/stm8s_flash_private.c: 259: FLASH->CR2 |= FLASH_CR2_FPRG;
      0000A1 AA 10            [ 1]  189 	or	a, #0x10
      0000A3 C7 50 5B         [ 1]  190 	ld	0x505b, a
                                    191 ;	./src/stm8s_flash_private.c: 260: FLASH->NCR2 &= (uint8_t)(~FLASH_NCR2_NFPRG);
      0000A6 72 19 50 5C      [ 1]  192 	bres	20572, #4
                                    193 ;	./src/stm8s_flash_private.c: 264: for(Count = 0; Count < FLASH_BLOCK_SIZE; Count++)
      0000AA                        194 00114$:
      0000AA 90 5F            [ 1]  195 	clrw	y
      0000AC                        196 00108$:
                                    197 ;	./src/stm8s_flash_private.c: 266: *((PointerAttr uint8_t*) (MemoryAddressCast)startaddress + Count) = ((uint8_t)(Buffer[Count]));
      0000AC 1E 03            [ 2]  198 	ldw	x, (0x03, sp)
      0000AE 1F 05            [ 2]  199 	ldw	(0x05, sp), x
      0000B0 93               [ 1]  200 	ldw	x, y
      0000B1 72 FB 05         [ 2]  201 	addw	x, (0x05, sp)
      0000B4 1F 07            [ 2]  202 	ldw	(0x07, sp), x
      0000B6 93               [ 1]  203 	ldw	x, y
      0000B7 72 FB 0F         [ 2]  204 	addw	x, (0x0f, sp)
      0000BA F6               [ 1]  205 	ld	a, (x)
      0000BB 1E 07            [ 2]  206 	ldw	x, (0x07, sp)
      0000BD F7               [ 1]  207 	ld	(x), a
                                    208 ;	./src/stm8s_flash_private.c: 264: for(Count = 0; Count < FLASH_BLOCK_SIZE; Count++)
      0000BE 90 5C            [ 1]  209 	incw	y
      0000C0 90 A3 00 40      [ 2]  210 	cpw	y, #0x0040
      0000C4 25 E6            [ 1]  211 	jrc	00108$
                                    212 ;	./src/stm8s_flash_private.c: 268: }
      0000C6 5B 08            [ 2]  213 	addw	sp, #8
      0000C8 81               [ 4]  214 	ret
                                    215 	.area CODE
                                    216 	.area CONST
                                    217 	.area INITIALIZER
                                    218 	.area CABS (ABS)
